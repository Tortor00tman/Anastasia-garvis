<!DOCTYPE html>
<html lang="uk">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Jarvis UI — Neon Reactive</title>
<style>
  :root{
    --bg:#070a12;
    --fg:#e6f1ff;
    --fg-dim:#9bb3d1;
    --primary:#38bdf8;  /* неон-синій */
    --secondary:#a78bfa;/* неон-фіолет */
    --accent:#22d3ee;   /* бірюза */
    --danger:#ff5470;
  }

  /* Скидання + базова типографія */
  *{ box-sizing:border-box; }
  html,body{ height:100%; }
  body{
    margin:0;
    font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, "Inter", "SF Pro Text", "Helvetica Neue", Arial;
    background: radial-gradient(1200px 800px at 50% 40%, #0d1322 0%, var(--bg) 60%, #05070c 100%);
    color:var(--fg);
    overflow:hidden;
  }

  /* Фонова сітка та легкий шум */
  .backdrop{
    position:fixed; inset:0; pointer-events:none; z-index:0;
    background:
      radial-gradient(60vw 60vw at 50% -10%, rgba(56,189,248,.08), transparent 60%),
      radial-gradient(45vw 45vw at -10% 110%, rgba(167,139,250,.07), transparent 60%),
      radial-gradient(40vw 40vw at 110% 90%, rgba(34,211,238,.06), transparent 60%);
  }
  .grid{
    position:absolute; inset:-200vmax; opacity:.08; filter:contrast(120%);
    background-image:
      linear-gradient(to right, #fff 1px, transparent 1px),
      linear-gradient(to bottom, #fff 1px, transparent 1px);
    background-size: 48px 48px, 48px 48px;
    mask-image: radial-gradient(70% 70% at 50% 50%, #000 10%, transparent 100%);
  }
  .noise{
    position:fixed; inset:0; pointer-events:none; z-index:1; opacity:.04;
    background-image:url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="140" height="140"><filter id="n"><feTurbulence type="fractalNoise" baseFrequency="0.7" numOctaves="2" stitchTiles="stitch"/></filter><rect width="100%" height="100%" filter="url(%23n)"/></svg>');
    mix-blend-mode:soft-light;
  }

  /* Центровий контейнер */
  .wrap{
    position:relative; z-index:2;
    height:100%; width:100%;
    display:grid; place-items:center;
    padding:24px;
  }

  /* Центральний блок з колом і індикаторами */
  .core{
    position:relative;
    width:min(70vmin,560px);
    aspect-ratio:1/1;
    display:grid; place-items:center;
  }

  /* Неоновий ореол позаду */
  .aura{
    position:absolute; inset:0;
    filter: blur(40px) saturate(140%);
    background:
      conic-gradient(from 0deg,
       rgba(56,189,248,.12),
       rgba(167,139,250,.12),
       rgba(34,211,238,.12),
       rgba(56,189,248,.12));
    border-radius:50%;
    animation: spin 18s linear infinite;
    mask: radial-gradient(circle at 50% 50%, #000 40%, transparent 68%);
  }

  /* Головне коло */
  .orb{
    position:relative;
    width: 70%;
    aspect-ratio:1/1;
    border-radius:50%;
    background:
      radial-gradient(circle at 50% 35%, rgba(255,255,255,.18), rgba(255,255,255,.02) 40%),
      radial-gradient(circle at 50% 65%, rgba(34,211,238,.25), rgba(56,189,248,.15) 45%, rgba(167,139,250,.10) 70%, rgba(0,0,0,.0) 71%);
    box-shadow:
      0 0 40px rgba(56,189,248,.25),
      inset 0 0 40px rgba(167,139,250,.18),
      inset 0 0 80px rgba(34,211,238,.15);
    transition: transform .2s ease-out;
    display:grid; place-items:center;
  }
  .orb::before{
    content:"";
    position:absolute; inset:12%;
    border-radius:50%;
    border: 2px solid rgba(168, 189, 255, .18);
    box-shadow: 0 0 20px rgba(56,189,248,.25), inset 0 0 40px rgba(56,189,248,.15);
    mask: radial-gradient(circle at 50% 50%, transparent 55%, #000 56%);
    animation: breathe 3.5s ease-in-out infinite;
  }

  /* Кільця */
  .rings{
    position:absolute; inset:0; border-radius:50%;
    background:
      radial-gradient(closest-side, rgba(56,189,248,.12), transparent 60%) center/100% 100% no-repeat,
      radial-gradient(closest-side, rgba(167,139,250,.10), transparent 58%) center/100% 100% no-repeat,
      radial-gradient(closest-side, rgba(34,211,238,.10), transparent 56%) center/100% 100% no-repeat;
    animation: pulse 2.4s ease-in-out infinite;
    mix-blend-mode:screen;
    pointer-events:none;
  }

  /* Поле підказок/статусу */
  .hud{
    position:absolute; inset:auto 0 -96px 0;
    display:flex; flex-direction:column; align-items:center; gap:10px;
    color:var(--fg-dim);
    text-align:center;
  }

  .title{
    font-weight:700;
    letter-spacing:.12em;
    text-transform:uppercase;
    font-size: clamp(12px, 2.4vw, 14px);
    color:#a6c5ff;
    opacity:.85;
  }
  .status{
    font-size:clamp(16px, 3vw, 20px);
    font-weight:600;
    color:#dbe9ff;
    text-shadow:0 0 12px rgba(56,189,248,.3);
  }
  .hint{ font-size:14px; opacity:.75; }

  /* Кнопки */
  .controls{
    position:fixed; left:50%; bottom:32px; transform:translateX(-50%);
    display:flex; gap:12px; z-index:3;
  }
  .btn{
    appearance:none; border:0; outline:none; cursor:pointer;
    padding:14px 18px; border-radius:14px;
    background: linear-gradient(180deg, rgba(56,189,248,.25), rgba(56,189,248,.12));
    color:var(--fg); font-weight:700; letter-spacing:.02em;
    box-shadow:
      0 10px 22px rgba(56,189,248,.18),
      inset 0 0 0 1px rgba(168,189,255,.25);
    backdrop-filter: blur(6px) brightness(1.2);
    -webkit-backdrop-filter: blur(6px) brightness(1.2);
    transition: transform .15s ease, box-shadow .2s ease;
  }
  .btn:hover{ transform: translateY(-1px); box-shadow: 0 16px 30px rgba(56,189,248,.22), inset 0 0 0 1px rgba(168,189,255,.35); }
  .btn:active{ transform: translateY(0); }

  .btn.secondary{
    background: linear-gradient(180deg, rgba(167,139,250,.24), rgba(167,139,250,.12));
    box-shadow: 0 10px 22px rgba(167,139,250,.18), inset 0 0 0 1px rgba(168,189,255,.22);
  }
  .btn.danger{
    background: linear-gradient(180deg, rgba(255,84,112,.26), rgba(255,84,112,.1));
    box-shadow: 0 10px 22px rgba(255,84,112,.2), inset 0 0 0 1px rgba(255,84,112,.25);
  }

  /* Плаваючі “частинки” навколо */
  .field{
    position:absolute; inset: -8vmin; border-radius:50%; pointer-events:none;
    filter: drop-shadow(0 0 8px rgba(56,189,248,.45));
  }
  .particle{
    position:absolute; width:6px; height:6px; border-radius:50%;
    background: radial-gradient(circle, white 0%, rgba(56,189,248, .0) 65%);
    opacity:.9;
    animation: drift var(--t, 8s) ease-in-out infinite;
  }

  /* Технічні елементи для Canvas */
  canvas#viz{
    position:absolute; inset:-10% -10% -10% -10%;
    width:120%; height:120%;
    filter: blur(0.3px) saturate(110%) contrast(110%);
    pointer-events:none;
  }

  /* Куча приємних анімацій */
  @keyframes spin{ to{ transform: rotate(360deg); } }
  @keyframes breathe{
    0%,100%{ transform: scale(1); opacity:.8; }
    50%{ transform: scale(1.03); opacity:1; }
  }
  @keyframes pulse{
    0%,100%{ transform: scale(1); opacity:.75; }
    50%{ transform: scale(1.04); opacity:1; }
  }
  @keyframes drift{
    0%{ transform: translate3d(0,0,0) }
    50%{ transform: translate3d(var(--dx, 20px), var(--dy, -30px), 0) }
    100%{ transform: translate3d(0,0,0) }
  }

  /* Респонсивність */
  @media (max-width:640px){
    .hud{ inset:auto 0 -72px 0; }
    .btn{ padding:12px 14px; border-radius:12px; }
  }
</style>
</head>
<body>
  <div class="backdrop"><div class="grid"></div></div>
  <div class="noise"></div>

  <div class="wrap" aria-live="polite">
    <div class="core" id="core" aria-label="Jarvis core visual">
      <div class="aura"></div>
      <canvas id="viz"></canvas>
      <div class="rings" id="rings"></div>
      <div class="orb" id="orb">
        <div class="field" id="field"></div>
      </div>

      <div class="hud">
        <div class="title">Проєкт “Jarvis” — візуальний інтерфейс</div>
        <div class="status" id="status">Готовий. Натисніть «Почати».</div>
        <div class="hint">Після дозволу на мікрофон говоріть — коло реагує на ваш голос.</div>
      </div>
    </div>
  </div>

  <div class="controls">
    <button class="btn" id="btnStart">▶︎ Почати</button>
    <button class="btn secondary" id="btnMute" disabled>Заглушити</button>
    <button class="btn danger" id="btnStop" disabled>Зупинити</button>
  </div>

<script>
/* ============================
   Jarvis Reactive Front — single file
   ============================ */
(() => {
  const statusEl = document.getElementById('status');
  const orb = document.getElementById('orb');
  const rings = document.getElementById('rings');
  const core = document.getElementById('core');
  const field = document.getElementById('field');
  const btnStart = document.getElementById('btnStart');
  const btnMute = document.getElementById('btnMute');
  const btnStop = document.getElementById('btnStop');

  // Canvas для додаткової візуалізації
  const canvas = document.getElementById('viz');
  const ctx = canvas.getContext('2d', { alpha: true });

  let audioCtx, analyser, mediaStream, sourceNode, rafId;
  let muted = false;
  let started = false;

  // Створюємо красиві "частинки" навколо ядра
  function seedParticles(count = 32){
    field.innerHTML = '';
    const rect = field.getBoundingClientRect();
    for(let i=0;i<count;i++){
      const p = document.createElement('div');
      p.className = 'particle';
      const r = Math.random();
      const angle = Math.random() * Math.PI * 2;
      const radius = (rect.width/2) * (0.72 + Math.random()*0.25);
      const cx = rect.width/2 + Math.cos(angle) * radius;
      const cy = rect.height/2 + Math.sin(angle) * radius;
      p.style.left = `${cx}px`;
      p.style.top = `${cy}px`;
      p.style.setProperty('--dx', `${(Math.random()*60-30).toFixed(1)}px`);
      p.style.setProperty('--dy', `${(Math.random()*60-30).toFixed(1)}px`);
      p.style.setProperty('--t', `${(8 + Math.random()*6).toFixed(2)}s`);
      p.style.width = p.style.height = `${4 + Math.floor(Math.random()*4)}px`;
      p.style.opacity = 0.7 + Math.random()*0.3;
      field.appendChild(p);
    }
  }

  // Ресайз для canvas
  function fitCanvas(){
    const ratio = window.devicePixelRatio || 1;
    const rect = core.getBoundingClientRect();
    canvas.width = Math.floor(rect.width * 1.2 * ratio);
    canvas.height = Math.floor(rect.height * 1.2 * ratio);
  }

  window.addEventListener('resize', () => {
    fitCanvas();
    seedParticles(36);
  });

  fitCanvas();
  seedParticles(36);

  // Аудіо-пайплайн
  async function initMic(){
    try{
      mediaStream = await navigator.mediaDevices.getUserMedia({ audio: { echoCancellation:true, noiseSuppression:true }, video:false });
    }catch(err){
      statusEl.textContent = 'Помилка доступу до мікрофона: ' + (err.message || err.name);
      statusEl.style.color = 'var(--danger)';
      return;
    }

    audioCtx = new (window.AudioContext || window.webkitAudioContext)();
    sourceNode = audioCtx.createMediaStreamSource(mediaStream);
    analyser = audioCtx.createAnalyser();
    analyser.fftSize = 1024;
    analyser.smoothingTimeConstant = 0.85;

    sourceNode.connect(analyser);

    // iOS requires resume on user gesture; кнопка вже була натиснута
    if(audioCtx.state === 'suspended'){
      await audioCtx.resume();
    }

    statusEl.textContent = 'Слухаю… Говоріть.';
    btnMute.disabled = false;
    btnStop.disabled = false;
    started = true;
    loop();
  }

  // Розрахунок рівня гучності (RMS)
  const dataArray = new Uint8Array(512);
  function getLevel(){
    analyser.getByteTimeDomainData(dataArray);
    // нормалізація [0..255] -> [-1..1]
    let sum = 0;
    for(let i=0; i<dataArray.length; i++){
      const v = (dataArray[i] - 128) / 128;
      sum += v*v;
    }
    const rms = Math.sqrt(sum / dataArray.length);
    return rms; // ~0..1
  }

  // Головний цикл анімацій
  let t = 0;
  function loop(){
    cancelAnimationFrame(rafId);
    rafId = requestAnimationFrame(loop);

    t += 0.016;
    ctx.clearRect(0,0,canvas.width,canvas.height);

    const ratio = window.devicePixelRatio || 1;
    const w = canvas.width, h = canvas.height;
    const cx = w/2, cy = h/2;

    let level = muted ? 0 : (analyser ? getLevel() : 0);
    // Робимо реакцію трохи чутливішою
    level = Math.min(1, level * 3.2);

    // Візуал: пульсація орбіти та кілець
    const scale = 1 + level * 0.08;
    const ringPulse = 1 + level * 0.15;

    orb.style.transform = `scale(${scale})`;
    rings.style.transform = `scale(${ringPulse})`;
    rings.style.opacity = String(0.6 + level * 0.4);

    // Неонові хвилі + спектральне кільце
    const layers = 3;
    for(let i=0;i<layers;i++){
      const R = Math.min(w,h) * (0.18 + i*0.12 + level*0.05);
      ctx.beginPath();
      ctx.arc(cx, cy, R, 0, Math.PI*2);
      ctx.lineWidth = 2 * ratio;
      ctx.strokeStyle = `rgba(${160+i*20}, ${220-i*20}, 255, ${0.18 - i*0.04 + level*0.12})`;
      ctx.shadowColor = 'rgba(56,189,248,0.35)';
      ctx.shadowBlur = 24 * ratio;
      ctx.stroke();
    }

    // Динамічні “пелюстки” спектру (low-poly стиль)
    const bins = 48;
    const freqData = new Uint8Array(analyser ? analyser.frequencyBinCount : 0);
    if(analyser){
      analyser.getByteFrequencyData(freqData);
    }
    const baseR = Math.min(w,h) * (0.22 + level*0.04);
    ctx.beginPath();
    for(let i=0;i<bins;i++){
      const a = (i / bins) * Math.PI * 2 + t*0.6;
      const mag = analyser ? (freqData[i] || 0)/255 : 0;
      const r = baseR + (mag * 34 * ratio);
      const x = cx + Math.cos(a) * r;
      const y = cy + Math.sin(a) * r;
      if(i===0) ctx.moveTo(x,y); else ctx.lineTo(x,y);
    }
    ctx.closePath();
    ctx.fillStyle = `rgba(56,189,248, ${0.08 + level*0.10})`;
    ctx.fill();

    // Світловий “дотік”
    const glowR = baseR + 40 * ratio + level * 60 * ratio;
    const grad = ctx.createRadialGradient(cx, cy, baseR*0.3, cx, cy, glowR);
    grad.addColorStop(0, `rgba(167,139,250, ${0.10 + level*0.15})`);
    grad.addColorStop(1, 'rgba(0,0,0,0)');
    ctx.fillStyle = grad;
    ctx.beginPath(); ctx.arc(cx, cy, glowR, 0, Math.PI*2); ctx.fill();

    // Маленькі пульсуючі точки на кільці
    const dots = 12;
    for(let i=0;i<dots;i++){
      const a = (i/dots)*Math.PI*2 + t*(0.8 + i*0.02);
      const r = baseR + 20*ratio + Math.sin(t*1.6 + i)*6*ratio + level*10*ratio;
      const x = cx + Math.cos(a)*r;
      const y = cy + Math.sin(a)*r;
      ctx.beginPath();
      ctx.arc(x,y, 2.2*ratio + level*1.2, 0, Math.PI*2);
      ctx.fillStyle = `rgba(255,255,255, ${0.7 + Math.sin(t*2+i)*0.25})`;
      ctx.shadowColor = 'rgba(56,189,248,0.55)';
      ctx.shadowBlur = 16*ratio;
      ctx.fill();
    }
  }

  // Кнопки керування
  btnStart.addEventListener('click', async () => {
    if(started){
      // Якщо аудіо-контекст заморожений (iOS), спроба відновити
      if(audioCtx && audioCtx.state === 'suspended'){ await audioCtx.resume(); }
      statusEl.textContent = 'Слухаю… Говоріть.';
      return;
    }
    btnStart.disabled = true;
    statusEl.textContent = 'Запит доступу до мікрофона…';
    await initMic();
    if(!started){ btnStart.disabled = false; }
  });

  btnMute.addEventListener('click', () => {
    if(!started) return;
    muted = !muted;
    btnMute.textContent = muted ? 'Увімкнути звук' : 'Заглушити';
    statusEl.textContent = muted ? 'Мікрофон заглушено.' : 'Слухаю… Говоріть.';
  });

  btnStop.addEventListener('click', () => {
    if(!started) return;
    try{
      mediaStream && mediaStream.getTracks().forEach(t => t.stop());
      audioCtx && audioCtx.close();
    }catch(e){}
    window.cancelAnimationFrame(rafId);
    started = false; muted = false;
    btnStart.disabled = false;
    btnMute.disabled = true; btnMute.textContent = 'Заглушити';
    btnStop.disabled = true;
    statusEl.textContent = 'Зупинено. Натисніть «Почати», щоб знову активувати.';
    // Мʼякий відкат анімацій
    orb.style.transform = `scale(1)`;
    rings.style.transform = `scale(1)`;
    rings.style.opacity = '0.6';
  });

  // Клік по ядру — невеличкий відскок
  core.addEventListener('pointerdown', () => {
    core.animate([
      { transform:'scale(1)' },
      { transform:'scale(1.04)' },
      { transform:'scale(1)' }
    ], { duration:260, easing:'cubic-bezier(.21,.7,.3,1)' });
  });

  // Плавний паралакс
  let px = 0, py = 0;
  window.addEventListener('pointermove', (e) => {
    const r = core.getBoundingClientRect();
    const x = (e.clientX - (r.left + r.width/2)) / r.width;
    const y = (e.clientY - (r.top + r.height/2)) / r.height;
    px = x; py = y;
    orb.style.transform += ` translate(${x*6}px, ${y*6}px)`;
  });

  // Додаткова безпека: попередження, якщо немає HTTPS
  if(location.protocol !== 'https:' && location.hostname !== 'localhost'){
    statusEl.textContent = 'Для доступу до мікрофона потрібен HTTPS або localhost.';
  }
})();
</script>
</body>
</html>
